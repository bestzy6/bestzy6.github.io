<!doctype html><html lang=zh-Hans x-data :class=$store.darkMode.class() :data-theme=$store.darkMode.theme()><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><title>æ·±å…¥ç†è§£goconveyæ¡†æ¶æ‰§è¡Œé¡ºåº | Bestzy's Blog</title>
<link href=/favicon.ico rel=icon type=image/x-icon><link rel=canonical href=https://bestzy6.github.io/posts/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3goconvey%E6%A1%86%E6%9E%B6%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/><meta name=author content="bestzy"><meta name=description content="goconveyæ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„Goæµ‹è¯•æ¡†æ¶ï¼Œæœ¬æ–‡å°†æ·±å…¥æ¢è®¨goconveyçš„æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œé¡ºåºã€‚
"><meta name=keywords content="Golang,Go,å•å…ƒæµ‹è¯•"><meta name=generator content="Hugo 0.145.0"><meta property="og:url" content="https://bestzy6.github.io/posts/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3goconvey%E6%A1%86%E6%9E%B6%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/"><meta property="og:site_name" content="Bestzy's Blog"><meta property="og:title" content="æ·±å…¥ç†è§£goconveyæ¡†æ¶æ‰§è¡Œé¡ºåº"><meta property="og:description" content="goconveyæ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„Goæµ‹è¯•æ¡†æ¶ï¼Œæœ¬æ–‡å°†æ·±å…¥æ¢è®¨goconveyçš„æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œé¡ºåºã€‚"><meta property="og:locale" content="zh_Hans"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-30T22:34:28+08:00"><meta property="article:modified_time" content="2024-11-30T22:34:28+08:00"><meta property="article:tag" content="Golang"><meta property="article:tag" content="Go"><meta property="article:tag" content="å•å…ƒæµ‹è¯•"><meta property="og:image" content="https://bestzy6.github.io/me/og.png"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://bestzy6.github.io/me/og.png"><meta name=twitter:title content="æ·±å…¥ç†è§£goconveyæ¡†æ¶æ‰§è¡Œé¡ºåº"><meta name=twitter:description content="goconveyæ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„Goæµ‹è¯•æ¡†æ¶ï¼Œæœ¬æ–‡å°†æ·±å…¥æ¢è®¨goconveyçš„æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œé¡ºåºã€‚"><link rel=stylesheet href=/css/output.min.css><style>pre{padding:1em;overflow:auto}</style><script defer src=https://cdn.jsdelivr.net/npm/alpinejs@3/dist/cdn.min.js integrity="sha256-PtHu0lJIiSHfZeNj1nFd6wTX+Squ255SGZ/fc8seCtM=" crossorigin=anonymous></script><meta name=referrer content="no-referrer"></head><body x-data="{
    flip: false,
  }"><div id=dream-global-bg></div><nav x-data="{ isSticky: false }" x-init="window.addEventListener('scroll', () => { isSticky = window.scrollY > 30 })" class="sticky top-0 z-30 mt-4 lg:mt-8 py-4" :class="{ 'bg-base-100 shadow-lg dark:border-b dark:border-base-content/30': isSticky }"><div class="container flex justify-between px-4"><section class="flex items-center gap-4"><div class="avatar cursor-pointer hover:avatar-online" @click="flip = !flip" title=ç¿»è½¬ä¸€ä¸‹ï¼><div class="h-10 rounded-full"><img src="https://avatars.githubusercontent.com/u/43753176?v=4" alt=Bestzy></div></div><div><a href=https://bestzy6.github.io/ class="text-lg font-semibold cursor-pointer">Bestzy</a><div class="text-base-content/60 text-sm">ğŸš€å…ˆè¡Œå…¶äº‹ï¼Œåè‡»å…¶å–„ï¼Œå†æ±‚å…¶ä¼˜ï¼</div></div></section><div class="dropdown dropdown-end sm:hidden"><div tabindex=0 role=button class="btn btn-ghost btn-square" aria-label="Select an option"><ion-icon name=menu class=text-2xl></ion-icon></div><ul tabindex=0 class="dropdown-content menu w-36 bg-base-100 rounded-box z-1 shadow-md"><li><a class="group inline-flex items-center p-2 cursor-pointer" href=/search title=æœç´¢><ion-icon name=search></ion-icon>æœç´¢</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/index.xml title=RSS><ion-icon name=logo-rss></ion-icon>RSS</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/posts title=å½’æ¡£><ion-icon name=archive></ion-icon>å½’æ¡£</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/categories title=æ‰€æœ‰åˆ†ç±»><ion-icon name=grid></ion-icon>æ‰€æœ‰åˆ†ç±»</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/tags title=æ‰€æœ‰æ ‡ç­¾><ion-icon name=pricetags></ion-icon>æ‰€æœ‰æ ‡ç­¾</a></li></ul></div><section class="hidden sm:flex sm:items-center sm:gap-2 md:gap-4"><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/search title=æœç´¢><ion-icon class=group-hover:text-primary-content name=search></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href=/index.xml title=RSS><ion-icon class=group-hover:text-primary-content name=logo-rss></ion-icon></a><div class="dropdown dropdown-end dropdown-hover"><div tabindex=0 role=button class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" aria-label="Select an option"><ion-icon class="group-hover:text-primary-content text-xl" name=menu></ion-icon></div><ul tabindex=0 class="dropdown-content menu w-36 bg-base-100 rounded-box z-1 shadow-xl"><li><a class="inline-flex items-center p-2 cursor-pointer" href=/posts title=å½’æ¡£><ion-icon name=archive></ion-icon>å½’æ¡£</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/categories title=æ‰€æœ‰åˆ†ç±»><ion-icon name=grid></ion-icon>æ‰€æœ‰åˆ†ç±»</a></li><li><a class="inline-flex items-center p-2 cursor-pointer" href=/tags title=æ‰€æœ‰æ ‡ç­¾><ion-icon name=pricetags></ion-icon>æ‰€æœ‰æ ‡ç­¾</a></li></ul></div></section></div></nav><div class=flip-container :class="{ 'flip-it': flip }"><div class=flipper><div class=front><div class=container><div class="lg:grid lg:grid-cols-4 gap-4 mt-4 px-4"><div class="hidden lg:block"></div><div class=lg:col-span-2><article class="mx-auto prose prose-quoteless dark:prose-invert" id=dream-single-post-main itemscope itemtype=http://schema.org/Article><meta itemprop=name content="æ·±å…¥ç†è§£goconveyæ¡†æ¶æ‰§è¡Œé¡ºåº"><meta itemprop=description content="goconveyæ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„Goæµ‹è¯•æ¡†æ¶ï¼Œæœ¬æ–‡å°†æ·±å…¥æ¢è®¨goconveyçš„æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œé¡ºåºã€‚"><meta itemprop=datePublished content="2024-11-30T22:34:28+08:00"><meta itemprop=dateModified content="2024-11-30T22:34:28+08:00"><meta itemprop=wordCount content="2765"><meta itemprop=image content="https://bestzy6.github.io/me/og.png"><meta itemprop=keywords content="Golang,Go,å•å…ƒæµ‹è¯•"><header><h1 itemprop=headline>æ·±å…¥ç†è§£goconveyæ¡†æ¶æ‰§è¡Œé¡ºåº</h1><p class=text-sm><span data-format=luxon>2024-11-30T22:34:28+08:00</span>
| <span>6åˆ†é’Ÿé˜…è¯»</span></p><div class="flex justify-between"><div class="flex items-center"><div class="avatar mr-1"><div class="w-8 rounded-full"><img class=my-0! src="https://avatars.githubusercontent.com/u/43753176?v=4" alt=bestzy></div></div><span itemprop=author itemscope itemtype=https://schema.org/Person><span itemprop=name>bestzy</span></span></div><div class="flex items-center gap-2"><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://x.com/intent/post?text=%e6%b7%b1%e5%85%a5%e7%90%86%e8%a7%a3goconvey%e6%a1%86%e6%9e%b6%e6%89%a7%e8%a1%8c%e9%a1%ba%e5%ba%8f&amp;url=https://bestzy6.github.io/posts/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3goconvey%E6%A1%86%E6%9E%B6%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/" target=_blank rel="noopener noreferrer" title="Share on X"><ion-icon class=group-hover:text-primary-content name=logo-x></ion-icon></a><a class="group inline-flex items-center p-2 rounded-full cursor-pointer hover:bg-primary" href="https://facebook.com/sharer/sharer.php?u=https://bestzy6.github.io/posts/%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3goconvey%E6%A1%86%E6%9E%B6%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F/" target=_blank rel="noopener noreferrer" title="Share on Facebook"><ion-icon class=group-hover:text-primary-content name=logo-facebook></ion-icon></a></div></div></header><section id=dream-single-post-content itemprop=articleBody><img class="w-full z-30" src=https://i0.hdslb.com/bfs/article/0a64a0eac0027c30a6f2e85c76065b142099359.jpg@1e_1c.webp alt=æ·±å…¥ç†è§£goconveyæ¡†æ¶æ‰§è¡Œé¡ºåº><p>goconveyæ˜¯ä¸€ä¸ªéå¸¸å¥½ç”¨çš„Goæµ‹è¯•æ¡†æ¶ï¼Œæœ¬æ–‡å°†æ·±å…¥æ¢è®¨goconveyçš„æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œé¡ºåºã€‚</p><h2 id=å‰è¨€>å‰è¨€</h2><p>goconveyç›´æ¥ä¸go testé›†æˆï¼Œæä¾›äº†å¾ˆå¤šä¸°å¯Œçš„æ–­è¨€å‡½æ•°ï¼Œèƒ½å¤Ÿåœ¨ç»ˆç«¯è¾“å‡ºå¯è¯»çš„å½©è‰²æµ‹è¯•ç»“æœï¼Œå¹¶ä¸”è¿˜æ”¯æŒå…¨è‡ªåŠ¨çš„Web UIã€‚æœ¬æ–‡å°†æ·±å…¥æ¢è®¨goconveyçš„æµ‹è¯•ç”¨ä¾‹æ‰§è¡Œé¡ºåºã€‚</p><h2 id=ä»£ç éªŒè¯>ä»£ç éªŒè¯</h2><h3 id=æ‰§è¡Œé¡ºåº>æ‰§è¡Œé¡ºåº</h3><p>å…ˆè¯´ç»“è®ºï¼ŒConveyæŒ‰ç…§æ ‘å½¢ç»“æ„æ·±åº¦éå†é¡ºåºæ‰§è¡Œçš„ã€‚</p><p>ä¸ºäº†éªŒè¯Conveyçš„æ‰§è¡Œé¡ºåºï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä»¥ä¸‹ä»£ç ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestConvey</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Convey</span>(<span style=color:#e6db74>&#34;L1&#34;</span>, <span style=color:#a6e22e>t</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;L1&#34;</span>)
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Reset</span>(<span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;End|&#34;</span>)
</span></span><span style=display:flex><span>       })
</span></span><span style=display:flex><span>       
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Convey</span>(<span style=color:#e6db74>&#34;L2-1&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;L2-1&#34;</span>)
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Convey</span>(<span style=color:#e6db74>&#34;L3-1&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>             <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;L3-1&#34;</span>)
</span></span><span style=display:flex><span>          })
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Convey</span>(<span style=color:#e6db74>&#34;L3-2&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>             <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;L3-2&#34;</span>)
</span></span><span style=display:flex><span>          })
</span></span><span style=display:flex><span>       })
</span></span><span style=display:flex><span>       
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Convey</span>(<span style=color:#e6db74>&#34;L2-2&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;L2-2&#34;</span>)
</span></span><span style=display:flex><span>       })
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>æ‰§è¡Œåï¼Œä»¥ä¸Šä»£ç å°†æ‰“å°ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Plain data-lang=Plain><span style=display:flex><span>L1L2-1L3-1End|L1L2-1L3-2End|L1L2-2End|
</span></span></code></pre></div><p>å¯ä»¥çœ‹åˆ°ï¼Œå¦‚æœå°†Conveyå‡½æ•°å½“æˆä¸€æ£µæ ‘ï¼Œé‚£ä¹ˆæ‰§è¡Œé¡ºåºç±»ä¼¼äºæ·±åº¦éå†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p><p><img src=https://i0.hdslb.com/bfs/article/4d9952dfa804170a3a41f7ec68d5f8752099359.png@1e_1c.webp alt></p><p>é‚£ä¹ˆç»“åˆResetå‡½æ•°ï¼Œå°±å¯ä»¥å®ç°"SetUp"å’Œ"TearDown"æ¨¡å¼ã€‚</p><h3 id=å¹¶å‘æ€§>å¹¶å‘æ€§</h3><p>ç½‘ä¸Šæœ‰äº›æ–‡ç« è¯´åµŒå¥—çš„åŒçº§Conveyæ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œä½†å®é™…ä¸Šå¹¶éå¦‚æ­¤ã€‚</p><p>ä¸ºäº†æµ‹è¯•å¹¶å‘æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™å¦‚ä¸‹æµ‹è¯•ä»£ç ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestConvey</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Convey</span>(<span style=color:#e6db74>&#34;L1&#34;</span>, <span style=color:#a6e22e>t</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;L1&#34;</span>)
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Reset</span>(<span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;End|&#34;</span>)
</span></span><span style=display:flex><span>       })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Convey</span>(<span style=color:#e6db74>&#34;L2-1&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>1000</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;L2-1&#34;</span>)
</span></span><span style=display:flex><span>       })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Convey</span>(<span style=color:#e6db74>&#34;L2-2&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;L2-2&#34;</span>)
</span></span><span style=display:flex><span>       })
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ä»¥ä¸Šä»£ç ä¸­ï¼Œå­æµ‹è¯•<code>L2-1</code>ç¡çœ 1ç§’åå†æ‰“å°L2-1ï¼Œè€Œå­ç”¨ä¾‹<code>L2-2</code>å¹¶ä¸ä¼šç¡çœ ï¼Œå‡å¦‚Conveyæ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œé‚£ä¹ˆåº”è¯¥å…ˆæ‰“å°<code>L1L2-1End|</code>ï¼Œå†æ‰“å°<code>L1L2-2End|</code>ã€‚è€Œå®é™…ä¸Šï¼Œä»¥ä¸Šä»£ç ä»ç„¶æ˜¯æ‰“å°<code>L1L2-1End|L1L2-2End|</code>ï¼Œä¸”åœ¨æ‰§è¡Œæ—¶èƒ½æ˜æ˜¾åœ°æ„Ÿå—åˆ°æ§åˆ¶å°æ‰“å°<code>L1</code>ä¹‹åç¡çœ ä¸€æ®µæ—¶é—´å†æ‰“å°<code>L1L2-2End|</code>ã€‚</p><p>åœ¨<a href=https://github.com/smartystreets/goconvey/issues/632 target=_blank>github issue</a>
ä¸­ï¼Œä½œè€…ä¹Ÿè¡¨æ˜å­ç”¨ä¾‹ç›®å‰æ²¡æœ‰åŠæ³•å¹¶å‘æ‰§è¡Œã€‚</p><blockquote><p>There&rsquo;s currently no way to allow Convey suites to run in parallel (just top level TestXxx functions). However I&rsquo;m slowly working on a change to the Convey internals to fix this.</p><p>ç›®å‰è¿˜æ²¡æœ‰åŠæ³•å…è®¸ Convey å¥—ä»¶å¹¶è¡Œè¿è¡Œï¼ˆåªæœ‰é¡¶çº§ TestXxx å‡½æ•°ï¼‰ã€‚ä¸è¿‡ï¼Œæˆ‘æ­£åœ¨æ…¢æ…¢åœ°å¯¹ Convey å†…éƒ¨è¿›è¡Œæ›´æ”¹ä»¥è§£å†³æ­¤é—®é¢˜ã€‚</p></blockquote><p>é¡¶çº§æµ‹è¯•å‡½æ•°å¯ä»¥å¹¶å‘æ‰§è¡Œï¼Œéœ€è¦åˆ©ç”¨t.Parralel()å‡½æ•°ï¼Œå¦‚ä¸‹è¿°ä»£ç æ‰€ç¤ºï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestConvey</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Parallel</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Convey</span>(<span style=color:#e6db74>&#34;A&#34;</span>, <span style=color:#a6e22e>t</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;A&#34;</span>)
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Reset</span>(<span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;End&#34;</span>)
</span></span><span style=display:flex><span>       })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Convey</span>(<span style=color:#e6db74>&#34;B&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>3000</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;B&#34;</span>)
</span></span><span style=display:flex><span>       })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Convey</span>(<span style=color:#e6db74>&#34;C&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>10</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;C&#34;</span>)
</span></span><span style=display:flex><span>       })
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Convey</span>(<span style=color:#e6db74>&#34;D&#34;</span>, <span style=color:#a6e22e>t</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;D&#34;</span>)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestConvey2</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Parallel</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Convey</span>(<span style=color:#e6db74>&#34;E&#34;</span>, <span style=color:#a6e22e>t</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;E&#34;</span>)
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Reset</span>(<span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;End&#34;</span>)
</span></span><span style=display:flex><span>       })
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Sleep</span>(<span style=color:#ae81ff>3000</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>time</span>.<span style=color:#a6e22e>Millisecond</span>)
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å‡è®¾å½“å‰åŒ…ä¸­åªå­˜åœ¨æµ‹è¯•å‡½æ•°<code>TestConvey</code>å’Œ<code>TestConvey2</code>ï¼Œæ‰§è¡Œè¯¥åŒ…çš„æµ‹è¯•ç”¨ä¾‹æ—¶ï¼Œè¿è¡Œæ—¶é—´å¤§æ¦‚åœ¨3så·¦å³ã€‚å‡å¦‚å»æ‰ <em><code>t</code></em><code>.Parallel()</code>ï¼Œå•æµ‹è¿è¡Œæ—¶é—´å°†ä¼šå¢åŠ åˆ°6så·¦å³ã€‚</p><h2 id=æ·±å…¥ç†è§£>æ·±å…¥ç†è§£</h2><p>ä»¥ä¸‹æ–‡å­—å°†ä»ä»£ç è§’åº¦ï¼Œæ·±å…¥è§£é‡Šä¸ºä»€ä¹ˆConveyä¼šä½¿ç”¨dfsé¡ºåºæ‰§è¡Œä¸”æ— æ³•å¹¶è¡Œã€‚</p><h3 id=å…¥å£å‡½æ•°>å…¥å£å‡½æ•°</h3><p>ConveyåŒ…çš„å…¥å£å‡½æ•°<code>Convey</code>ä»£ç å¦‚ä¸‹ï¼š</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>Convey</span>(<span style=color:#a6e22e>items</span> <span style=color:#f92672>...</span><span style=color:#66d9ef>any</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>getCurrentContext</span>(); <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>rootConvey</span>(<span style=color:#a6e22e>items</span><span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>Convey</span>(<span style=color:#a6e22e>items</span><span style=color:#f92672>...</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å‡½æ•°åŒºåˆ†äº†æ ¹Conveyä¸å­Conveyã€‚æ¯ä¸ªConveyå—ä¼šåŠ¨æ€åˆ›å»ºæ ‘ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¹¶å°†å…¶æŒ‚è½½åˆ°å½“å‰ä¸Šä¸‹æ–‡å¯¹åº”çš„çˆ¶èŠ‚ç‚¹ä¸‹ã€‚</p><h3 id=ä¸Šä¸‹æ–‡ç®¡ç†>ä¸Šä¸‹æ–‡ç®¡ç†</h3><p><a href=https://github.com/smartystreets/goconvey/blob/master/convey/context.go target=_blank>ä¸Šä¸‹æ–‡</a>
æ˜¯Conveyå®ç°æ ‘å½¢ç»“æ„çš„æ ¸å¿ƒã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#66d9ef>type</span> <span style=color:#a6e22e>context</span> <span style=color:#66d9ef>struct</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>reporter</span> <span style=color:#a6e22e>reporting</span>.<span style=color:#a6e22e>Reporter</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>children</span> <span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#f92672>*</span><span style=color:#a6e22e>context</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>resets</span> []<span style=color:#66d9ef>func</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>executedOnce</span>   <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>expectChildRun</span> <span style=color:#f92672>*</span><span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>complete</span>       <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>focus</span>       <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>failureMode</span> <span style=color:#a6e22e>FailureMode</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>stackMode</span>   <span style=color:#a6e22e>StackMode</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>ä¸Šä¸‹æ–‡ç®¡ç†ç”¨åˆ°äº†<code>gls</code>ã€‚<code>gls</code> æ˜¯ä¸€ä¸ªå¼€æºåº“ï¼Œç”¨äºåœ¨ Go ä¸­å®ç°<strong>åç¨‹ï¼ˆgoroutineï¼‰æœ¬åœ°å­˜å‚¨</strong>ï¼ˆç±»ä¼¼äºçº¿ç¨‹æœ¬åœ°å­˜å‚¨ï¼ŒTLSï¼‰ã€‚æ¯ä¸ª <code>Convey</code> å—çš„æ‰§è¡Œä¾èµ–ä¸Šä¸‹æ–‡æ ˆæ¥è·Ÿè¸ªçˆ¶å­å…³ç³»å’Œå…±äº«çŠ¶æ€ï¼Œè€Œè¿™äº›ä¿¡æ¯å¿…é¡»åœ¨å¤šä¸ª goroutine ä¸­å®‰å…¨åœ°ä¼ é€’å’Œç®¡ç†ã€‚</p><p>å½“Conveyä¸ºæ ¹èŠ‚ç‚¹æ—¶ï¼Œå°†æ‰§è¡Œä»¥ä¸‹ä»£ç ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>rootConvey</span>(<span style=color:#a6e22e>items</span> <span style=color:#f92672>...</span><span style=color:#66d9ef>any</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>entry</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>discover</span>(<span style=color:#a6e22e>items</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Test</span> <span style=color:#f92672>==</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>conveyPanic</span>(<span style=color:#a6e22e>missingGoTest</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>expectChildRun</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// æ„å»ºä¸Šä¸‹æ–‡</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>context</span>{
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>reporter</span>: <span style=color:#a6e22e>buildReporter</span>(),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>children</span>: make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#f92672>*</span><span style=color:#a6e22e>context</span>),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>expectChildRun</span>: <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>expectChildRun</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>focus</span>:       <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Focus</span>,
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>failureMode</span>: <span style=color:#a6e22e>defaultFailureMode</span>.<span style=color:#a6e22e>combine</span>(<span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>FailMode</span>),
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>stackMode</span>:   <span style=color:#a6e22e>defaultStackMode</span>.<span style=color:#a6e22e>combine</span>(<span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>StackMode</span>),
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#75715e>// è®¾ç½®goroutineä¸Šä¸‹æ–‡</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>ctxMgr</span>.<span style=color:#a6e22e>SetValues</span>(<span style=color:#a6e22e>gls</span>.<span style=color:#a6e22e>Values</span>{<span style=color:#a6e22e>nodeKey</span>: <span style=color:#a6e22e>ctx</span>}, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>reporter</span>.<span style=color:#a6e22e>BeginStory</span>(<span style=color:#a6e22e>reporting</span>.<span style=color:#a6e22e>NewStoryReport</span>(<span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Test</span>))
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>reporter</span>.<span style=color:#a6e22e>EndStory</span>()
</span></span><span style=display:flex><span>                <span style=color:#75715e>// æ£€æŸ¥å½“å‰ä¸Šä¸‹æ–‡æ˜¯å¦ä»æœ‰æœªè¿è¡Œçš„æµ‹è¯•é€»è¾‘ï¼ˆå­ç”¨ä¾‹ï¼‰ã€‚</span>
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>shouldVisit</span>() {
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>conveyInner</span>(<span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Situation</span>, <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Func</span>)
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>expectChildRun</span> = <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>        })
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// å¦‚æœâ€œç”¨ä¾‹æœªå®Œæˆâ€ä¸”â€œä»ç„¶å­˜åœ¨å­ç”¨ä¾‹â€</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>c</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>context</span>) <span style=color:#a6e22e>shouldVisit</span>() <span style=color:#66d9ef>bool</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> !<span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>complete</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>c</span>.<span style=color:#a6e22e>expectChildRun</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å¦‚æœæ ¹<code>Convey</code>çš„<code>func</code>ä¸­ä»ç„¶å­˜åœ¨<code>Convey</code>ï¼Œé‚£ä¹ˆä¼šæ‰§è¡Œæ ¹èŠ‚ç‚¹çš„<code>Convey</code>æ–¹æ³•ï¼Œæ³¨æ„<code>RootConvey</code>æ–¹æ³•å°†ä¼šæ”¹å˜ä¸Šä¸‹æ–‡<code>nodeKey</code>çš„å€¼ï¼Œæ­¤æ—¶å¦‚æœ<code>å­Convey</code>ä¸­ä¾ç„¶å­˜åœ¨<code>Convey</code>ï¼Œé‚£ä¹ˆä¼šä»å…¥å£å‡½æ•°ä¸­è¯»å–åˆ°<code>å­Convey</code>çš„ä¸Šä¸‹æ–‡ï¼Œä»¥æ­¤é€’å½’ï¼Œå®ç°äº†DFSçš„éå†åŠŸèƒ½ã€‚</p><p>è€Œå¦‚æœåœ¨<code>Convey</code>ä¸­ä¸å­˜åœ¨<code>Convey</code>äº†ï¼Œé‚£ä¹ˆè¯¥å‡½æ•°ä¾¿ä¼šæ‰§è¡Œå®Œæ¯•å¹¶é€€å‡ºã€‚</p><p>æ³¨æ„åˆ°<code>RootConvey</code>ä¸­ä½¿ç”¨äº†forå¾ªç¯æ¥æ‰§è¡Œfuncï¼Œæ­¤æ—¶<code>RootConvey</code>çš„funcä¼šç»§ç»­æ‰§è¡Œï¼Œä½†å·²ç»æ‰§è¡Œè¿‡çš„<code>Convey</code>ä¼šè¢«è·³è¿‡ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#66d9ef>func</span> (<span style=color:#a6e22e>ctx</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>context</span>) <span style=color:#a6e22e>Convey</span>(<span style=color:#a6e22e>items</span> <span style=color:#f92672>...</span><span style=color:#66d9ef>any</span>) {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>entry</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>discover</span>(<span style=color:#a6e22e>items</span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// we&#39;re a branch, or leaf (on the wind)</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Test</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>conveyPanic</span>(<span style=color:#a6e22e>extraGoTest</span>)
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>focus</span> <span style=color:#f92672>&amp;&amp;</span> !<span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Focus</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>return</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>inner_ctx</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>context</span>
</span></span><span style=display:flex><span>        <span style=color:#75715e>// åˆ¤æ–­æ˜¯å¦æ‰§è¡Œè¿‡</span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>executedOnce</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ok</span> <span style=color:#66d9ef>bool</span>
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>inner_ctx</span>, <span style=color:#a6e22e>ok</span> = <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>children</span>[<span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Situation</span>]
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> !<span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>conveyPanic</span>(<span style=color:#a6e22e>differentConveySituations</span>, <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Situation</span>)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>                <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>ok</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>children</span>[<span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Situation</span>]; <span style=color:#a6e22e>ok</span> {
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>conveyPanic</span>(<span style=color:#a6e22e>multipleIdenticalConvey</span>, <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Situation</span>)
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>inner_ctx</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>context</span>{
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>reporter</span>: <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>reporter</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>children</span>: make(<span style=color:#66d9ef>map</span>[<span style=color:#66d9ef>string</span>]<span style=color:#f92672>*</span><span style=color:#a6e22e>context</span>),
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>expectChildRun</span>: <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>expectChildRun</span>,
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>focus</span>:       <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Focus</span>,
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>failureMode</span>: <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>failureMode</span>.<span style=color:#a6e22e>combine</span>(<span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>FailMode</span>),
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>stackMode</span>:   <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>stackMode</span>.<span style=color:#a6e22e>combine</span>(<span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>StackMode</span>),
</span></span><span style=display:flex><span>                }
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>children</span>[<span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Situation</span>] = <span style=color:#a6e22e>inner_ctx</span>
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>inner_ctx</span>.<span style=color:#a6e22e>shouldVisit</span>() {
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>ctxMgr</span>.<span style=color:#a6e22e>SetValues</span>(<span style=color:#a6e22e>gls</span>.<span style=color:#a6e22e>Values</span>{<span style=color:#a6e22e>nodeKey</span>: <span style=color:#a6e22e>inner_ctx</span>}, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>                        <span style=color:#a6e22e>inner_ctx</span>.<span style=color:#a6e22e>conveyInner</span>(<span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Situation</span>, <span style=color:#a6e22e>entry</span>.<span style=color:#a6e22e>Func</span>)
</span></span><span style=display:flex><span>                })
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>goconveyæ— æ³•å®ç°<code>æ ¹Convey</code>ä¸­çš„å„å­åœºæ™¯å¹¶å‘è¿è¡Œï¼Œä¸€ä¸ªåŸå› æ˜¯åœ¨æºç ä¸­ï¼Œ<code>gls</code>ä»…è®°å½•äº†ä¸€ä¸ªConveyä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œåœ¨æ·±åº¦éå†æ—¶ä¼šæ›´æ–°glsçš„nodeKeyä¸ºå½“å‰Conveyçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</p><p>æœ¬æ–‡å°†é€šè¿‡ä¸€ä¸ªåœºæ™¯æ¥è§£é‡ŠConveyæ˜¯å¦‚ä½•åœ¨æ‰§è¡Œå®Œå¶Conveyä¹‹åï¼Œåˆä¼šä»RootConveyå¼€å§‹æ‰§è¡Œã€‚</p><p>ä»¥ä¸‹ä»£ç ï¼Œ<code>ConveyC2</code>ä¼šæ–­è¨€å¤±è´¥ã€‚</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-Go data-lang=Go><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>TestConvey</span>(<span style=color:#a6e22e>t</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>testing</span>.<span style=color:#a6e22e>T</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>t</span>.<span style=color:#a6e22e>Parallel</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Convey</span>(<span style=color:#e6db74>&#34;A&#34;</span>, <span style=color:#a6e22e>t</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;A&#34;</span>)
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Reset</span>(<span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;End&#34;</span>)
</span></span><span style=display:flex><span>       })
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>a</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1</span>
</span></span><span style=display:flex><span>       
</span></span><span style=display:flex><span>       <span style=color:#a6e22e>Convey</span>(<span style=color:#e6db74>&#34;B&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;B&#34;</span>)
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Convey</span>(<span style=color:#e6db74>&#34;C&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>             <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;C&#34;</span>)
</span></span><span style=display:flex><span>             <span style=color:#a6e22e>So</span>(<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>ShouldEqual</span>, <span style=color:#ae81ff>1</span>)
</span></span><span style=display:flex><span>             <span style=color:#a6e22e>a</span><span style=color:#f92672>++</span>
</span></span><span style=display:flex><span>          })
</span></span><span style=display:flex><span>          
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>Convey</span>(<span style=color:#e6db74>&#34;C2&#34;</span>, <span style=color:#66d9ef>func</span>() {
</span></span><span style=display:flex><span>             <span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;C2&#34;</span>)
</span></span><span style=display:flex><span>             <span style=color:#a6e22e>So</span>(<span style=color:#a6e22e>a</span>, <span style=color:#a6e22e>ShouldEqual</span>, <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>          })
</span></span><span style=display:flex><span>       })
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>å› ä¸º<code>ConveyC</code>è¿è¡Œå®Œæˆä¹‹åï¼Œå‡½æ•°ä¼šæ‰§è¡Œåˆ°<code>Convey-C2</code>ï¼Œä½†æ­¤æ—¶<code>Convey-C2</code>å¹¶ä¸ä¼šæ‰§è¡Œï¼Œåªä¼šå°†è‡ªå·±æ·»åŠ åˆ°<code>ConveyB</code>ä¹‹ä¸‹ï¼Œç„¶åä¾¿é€€å‡ºäº†ï¼Œå› ä¸ºæ‰§è¡Œå®Œ<code>ConveyC</code>ä¹‹åï¼Œ<code>ConveyC</code>çš„<code>expectChildRun</code>å€¼å˜ä¸ºäº†<code>false</code>ï¼Œä¸æ»¡è¶³ç»§ç»­dfsçš„æ¡ä»¶ï¼ˆå³<code>shouldVisit()</code>ä¸º<code>true</code>ï¼‰ï¼Œå› æ­¤ä¼šè¿”å›ã€‚</p><p><code>ConveyA</code>ä½œä¸º<code>RootConvey</code>,ä¼šä¸€ç›´forå¾ªç¯ï¼Œç›´åˆ°æ‰€æœ‰æƒ…å†µå‡æ‰§è¡Œï¼Œæ¯æ¬¡forå¾ªç¯ä¼šå°†<code>expectChildRun</code>è®¾ç½®ä¸º<code>true</code>ï¼Œæ‰€ä»¥åˆä¼šé‡æ–°èµ°ä¸€éABã€‚</p><p>ä¸ºä»€ä¹ˆBè¿˜ä¼šæ‰§è¡Œå‘¢ï¼Ÿä¸æ˜¯Bç»“æŸçš„æ—¶å€™å·²ç»å°†<code>expectChildRun</code>è®¾ç½®ä¸ºäº†<code>false</code>å—ï¼Ÿå› ä¸º<code>ConveyB</code>çš„<code>expectChildRun</code>ä¸<code>ConveyA</code>çš„<code>expectChildRun</code>æ˜¯åŒä¸€å¯¹è±¡ï¼Œæ‰€ä»¥<code>ConveyA</code>å¯¹<code>expectChildRun</code>çš„æ”¹åŠ¨åŒæ—¶ä¼šå½±å“<code>ConveyB</code>ã€‚</p><p><code>ConveyC</code>å·²ç»è¿è¡Œå®Œæˆï¼ˆå³<code>Completed</code>ä¸º<code>true</code>ï¼‰ï¼Œå› æ­¤ä¼šè·³è¿‡<code>ConveyC</code>ï¼Œæ‰§è¡Œ<code>ConveyB</code>çš„å­ç”¨ä¾‹<code>ConveyC2</code>ï¼Œå› ä¸º<code>ConveyC</code>å¹¶æ²¡æœ‰æ‰§è¡Œï¼Œæ‰€ä»¥<code>a</code>çš„å€¼ä»ç„¶æ˜¯1ã€‚</p><h2 id=ä¸ºä»€ä¹ˆä½¿ç”¨gls>ä¸ºä»€ä¹ˆä½¿ç”¨gls</h2><p>ä¸ºä»€ä¹ˆä½¿ç”¨glsï¼Œè€Œä¸ä½¿ç”¨goåŸç”Ÿæä¾›çš„context.ContextåŒ…æ¥ä¼ é€’ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Ÿ</p><p>æˆ‘çŒœæƒ³æ˜¯<code>goconvey</code>æ—©æœŸç¡®å®šäº†ä½¿ç”¨glsæ¥éšå¼ä¼ é€’ä¸Šä¸‹æ–‡ï¼Œå¹¶ä¸”å½“å‰å®ç°å·²ç»è¶³å¤Ÿæˆç†Ÿå’Œç¨³å®šã€‚å¦‚æœåˆ‡æ¢åˆ° <code>context.Context</code>ï¼Œå¯èƒ½éœ€è¦é‡æ„åº•å±‚é€»è¾‘ï¼Œä¸”å¸¦æ¥é¢å¤–çš„ç»´æŠ¤å¤æ‚æ€§ã€‚</p><p>ä¸ºäº†ä½è¯æˆ‘çš„çŒœæƒ³ï¼Œæˆ‘æ‰¾åˆ°äº†ä½œè€…åœ¨æŸä¸ª<a href=https://github.com/smartystreets/goconvey/issues/694 target=_blank>Issue</a>
ä¸­çš„å›ç­”ï¼Œå¦‚ä¸‹ï¼š</p><blockquote><p>Aside: I think really the better thing to do in this modern age is to stop using &ldquo;goroutine local storage&rdquo; altogether.</p><p>The next evolution of goconvey should rely entirely on explicit context passing instead - hiding the test context in a global variable just ends up causing confusion and bugs :/&mldr; Unfortunately such a change will be backwards incompatible which is why I haven&rsquo;t implemented it here.</p><p>æ—ç™½ï¼šæˆ‘è®¤ä¸ºåœ¨ç°ä»£ï¼Œæœ€å¥½çš„åŠæ³•æ˜¯å®Œå…¨åœæ­¢ä½¿ç”¨â€œgoroutineæœ¬åœ°å­˜å‚¨â€ã€‚goconveyçš„ä¸‹ä¸€ä¸ªè¿›åŒ–åº”è¯¥å®Œå…¨ä¾èµ–äºæ˜¾å¼çš„ä¸Šä¸‹æ–‡ä¼ é€’â€”â€”å°†æµ‹è¯•ä¸Šä¸‹æ–‡éšè—åœ¨å…¨å±€å˜é‡ä¸­åªä¼šå¯¼è‡´æ··ä¹±å’Œé”™è¯¯ï¼š/ã€‚ã€‚ã€‚ä¸å¹¸çš„æ˜¯ï¼Œè¿™æ ·çš„æ›´æ”¹å°†æ˜¯å‘åä¸å…¼å®¹çš„ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆæˆ‘æ²¡æœ‰åœ¨è¿™é‡Œå®ç°å®ƒã€‚</p></blockquote></section><div class=divider></div><section class=space-y-4><template x-if="['localhost', '127.0.0.1'].indexOf(window.location.hostname) == -1"><article><script src=https://utteranc.es/client.js repo=bestzy6/bestzy6.github.io issue-term=og:title theme=github-light crossorigin=anonymous async></script></article></template></section></article></div><div class="hidden lg:flex lg:flex-col lg:items-end"><nav id=TableOfContents><ul><li><a href=#å‰è¨€>å‰è¨€</a></li><li><a href=#ä»£ç éªŒè¯>ä»£ç éªŒè¯</a><ul><li><a href=#æ‰§è¡Œé¡ºåº>æ‰§è¡Œé¡ºåº</a></li><li><a href=#å¹¶å‘æ€§>å¹¶å‘æ€§</a></li></ul></li><li><a href=#æ·±å…¥ç†è§£>æ·±å…¥ç†è§£</a><ul><li><a href=#å…¥å£å‡½æ•°>å…¥å£å‡½æ•°</a></li><li><a href=#ä¸Šä¸‹æ–‡ç®¡ç†>ä¸Šä¸‹æ–‡ç®¡ç†</a></li></ul></li><li><a href=#ä¸ºä»€ä¹ˆä½¿ç”¨gls>ä¸ºä»€ä¹ˆä½¿ç”¨gls</a></li></ul></nav></div></div><footer class="flex justify-between items-center gap-2 px-4 py-12"><div><p>Â© 2025 Bestzy's Blog</p><p class=text-sm>ğŸŒ±
<span class=text-base-content/60>Powered by <a class=hover:underline href=https://gohugo.io/ target=_blank>Hugo</a> with theme
<a class=hover:underline href=https://github.com/g1eny0ung/hugo-theme-dream target=_blank>Dream</a>.</span></p></div><div x-data="{ icons: [
    { name: 'sunny', status: 'n' },
    { name: 'moon', status: 'y' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div><div class=back><div class=container><div class="dream-grid dream-grid-about"><div class="w-full md:w-1/2 lg:w-1/3 xl:w-1/4 p-4 dream-column"><article class="card bg-base-100 hover:bg-base-content/10 shadow-xl dark:border dark:border-base-content/30"><div class=card-body><div class=card-title>About Me</div><div class="prose dark:prose-invert"><p>ğŸ‘‹ Hi, This is Zheng Yi.</p></div></div></article></div></div><footer class="flex justify-between items-center gap-2 px-4 py-12"><div><p>Â© 2025 Bestzy's Blog</p><p class=text-sm>ğŸŒ±
<span class=text-base-content/60>Powered by <a class=hover:underline href=https://gohugo.io/ target=_blank>Hugo</a> with theme
<a class=hover:underline href=https://github.com/g1eny0ung/hugo-theme-dream target=_blank>Dream</a>.</span></p></div><div x-data="{ icons: [
    { name: 'sunny', status: 'n' },
    { name: 'moon', status: 'y' },
    { name: 'desktop', status: 'auto' }
  ] }" class="flex items-center gap-2 h-[32px] px-2 bg-base-100 border border-base-content/30 rounded-full"><template x-for="icon in icons"><div role=button tabindex=0 :aria-label="'Select ' + icon.name + ' mode'" class="group inline-flex justify-center items-center p-1 rounded-full cursor-pointer hover:bg-primary" :class="$store.darkMode.icon() === icon.name && 'bg-primary'" @click=$store.darkMode.toggle(icon.status)><ion-icon :name="`${icon.name}-outline`" class=group-hover:text-primary-content :class="$store.darkMode.icon() === icon.name && 'text-primary-content'"></ion-icon></div></template></div></footer></div></div></div></div><script>window.lightTheme="emerald",window.darkTheme="forest"</script><script src=https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin=anonymous></script><script src=/js/grid.min.js></script><script src=/js/main.min.js></script><script src=https://cdn.jsdelivr.net/npm/luxon@1.26.0 integrity="sha256-4sbTzmCCW9LGrIh5OsN8V5Pfdad1F1MwhLAOyXKnsE0=" crossorigin=anonymous></script><script>format();function format(){document.querySelectorAll('span[data-format="luxon"]').forEach(e=>{const t=e.textContent;e.textContent=luxon.DateTime.fromISO(t,{locale:"zh"}).toFormat("yyyyå¹´MMæœˆddæ—¥")})}</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-BR16XEQ6Y4"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BR16XEQ6Y4")}</script><script type=module src=https://cdn.jsdelivr.net/npm/ionicons@7.4.0/dist/ionicons/ionicons.esm.js integrity="sha256-/IFmi82bIhdYWctu0UddSlJqpnzWm7Vh2C4CM32wF/k=" crossorigin=anonymous></script><script nomodule src=https://cdn.jsdelivr.net/npm/ionicons@7.4.0/dist/ionicons/ionicons.js integrity="sha256-mr7eJMX3VC3F7G32mk4oWp1C6a2tlMYxUdptfT7uKI8=" crossorigin=anonymous></script></body></html>